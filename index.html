<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>קופה קטנה – הוצאות והכנסות</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-400 to-purple-500 min-h-screen">
  <div class="app-container max-w-3xl mx-auto p-4">
    <div class="navigation bg-white p-4 rounded-lg shadow mb-4">
      <h1 class="text-2xl font-bold text-center mb-2"><i class="fas fa-piggy-bank text-green-500"></i> קופה קטנה</h1>
      <p class="text-center text-gray-600">ניהול הוצאות והכנסות עם תקציב</p>
      <div class="flex justify-center gap-2 mt-3">
        <button class="nav-btn bg-gray-100 px-3 py-2 rounded active" onclick="showPage('add-transaction', this)"><i class="fas fa-plus"></i> הוספה</button>
        <button class="nav-btn bg-gray-100 px-3 py-2 rounded" onclick="showPage('list', this)"><i class="fas fa-list"></i> רשימה</button>
        <button class="nav-btn bg-gray-100 px-3 py-2 rounded" onclick="showPage('reports', this)"><i class="fas fa-chart-bar"></i> דוחות</button>
        <button class="nav-btn bg-gray-100 px-3 py-2 rounded" onclick="showPage('categories', this)"><i class="fas fa-tags"></i> קטגוריות</button>
        <button class="nav-btn bg-gray-100 px-3 py-2 rounded" onclick="showPage('settings', this)"><i class="fas fa-cog"></i> הגדרות</button>
      </div>
    </div>

    <!-- הוספת תנועה -->
    <div id="add-transaction" class="page bg-white rounded-lg p-4 shadow">
      <h2 class="text-xl font-bold mb-4"><i class="fas fa-plus-circle text-green-500"></i> הוספת תנועה</h2>
      <form id="transaction-form" class="grid grid-cols-1 gap-3">
        <div>
          <label class="block text-gray-700 text-sm mb-1">סוג</label>
          <select id="type" required>
            <option value="expense">הוצאה</option>
            <option value="income">הכנסה</option>
          </select>
        </div>
        <div>
          <label class="block text-gray-700 text-sm mb-1">סכום</label>
          <input type="number" id="amount" step="0.01" min="0" required placeholder="₪0.00" />
        </div>
        <div>
          <label class="block text-gray-700 text-sm mb-1">קטגוריה</label>
          <select id="category" required></select>
        </div>
        <div>
          <label class="block text-gray-700 text-sm mb-1">תיאור</label>
          <input type="text" id="description" required />
        </div>
        <div>
          <label class="block text-gray-700 text-sm mb-1">תאריך</label>
          <input type="date" id="date" required />
        </div>
        <button type="submit" class="bg-green-500 text-white px-3 py-2 rounded">שמור</button>
      </form>
    </div>

    <!-- רשימת תנועות -->
    <div id="list" class="page hidden bg-white rounded-lg p-4 shadow">
      <h2 class="text-xl font-bold mb-4"><i class="fas fa-list text-blue-500"></i> רשימת תנועות</h2>
      <div id="transactions-container"></div>
      <div class="mt-3 text-center"><strong>סה"כ: <span id="total">₪0</span></strong></div>
    </div>

    <!-- דוחות -->
    <div id="reports" class="page hidden bg-white rounded-lg p-4 shadow">
      <h2 class="text-xl font-bold mb-4"><i class="fas fa-chart-bar text-purple-500"></i> דוחות</h2>
      <div id="report-summary" class="mb-4"></div>
      <canvas id="report-chart"></canvas>
    </div>

    <!-- קטגוריות -->
    <div id="categories" class="page hidden bg-white rounded-lg p-4 shadow">
      <h2 class="text-xl font-bold mb-4"><i class="fas fa-tags text-orange-500"></i> קטגוריות</h2>
      <div class="mb-3 flex gap-2">
        <input type="text" id="new-category-name" placeholder="שם קטגוריה" class="border px-2" />
        <input type="number" id="new-category-budget" min="0" step="0.01" placeholder="תקציב" class="border px-2" />
        <button onclick="addCategory()" class="bg-green-500 text-white px-3 py-1 rounded">הוסף</button>
      </div>
      <div id="categories-container"></div>
    </div>

    <!-- הגדרות -->
    <div id="settings" class="page hidden bg-white rounded-lg p-4 shadow">
      <h2 class="text-xl font-bold mb-4"><i class="fas fa-cog text-gray-600"></i> הגדרות</h2>
      <label class="block mb-2">תקציב חודשי כולל</label>
      <input type="number" id="global-budget" min="0" step="0.01" class="border px-2" placeholder="₪0" />
    </div>
  </div>

<script>
let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
let categories = JSON.parse(localStorage.getItem('categories')) || [];
let globalBudget = parseFloat(localStorage.getItem('globalBudget')) || 0;

function saveData(){
  localStorage.setItem('transactions', JSON.stringify(transactions));
  localStorage.setItem('categories', JSON.stringify(categories));
  localStorage.setItem('globalBudget', globalBudget);
}

function showPage(id, btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('bg-green-500','text-white'));
  btn.classList.add('bg-green-500','text-white');
  if(id==='list') renderTransactions();
  if(id==='reports') renderReports();
  if(id==='categories') renderCategories();
}

document.getElementById('transaction-form').addEventListener('submit', e=>{
  e.preventDefault();
  const t = {
    id: Date.now(),
    type: document.getElementById('type').value,
    amount: parseFloat(document.getElementById('amount').value),
    category: document.getElementById('category').value,
    description: document.getElementById('description').value,
    date: document.getElementById('date').value
  };
  transactions.push(t);
  saveData();
  e.target.reset();
  alert('נשמר!');
});

function renderTransactions(){
  const c = document.getElementById('transactions-container');
  c.innerHTML='';
  let total=0;
  transactions.forEach(t=>{
    const div=document.createElement('div');
    div.className='border p-2 mb-2 flex justify-between';
    div.innerHTML=`<div><b>${t.type==='income'?'+':'-'}₪${t.amount}</b> | ${t.category} | ${t.description} | ${t.date}</div>
    <div><button onclick="editTransaction(${t.id})" class="text-blue-600">ערוך</button> <button onclick="deleteTransaction(${t.id})" class="text-red-600">מחק</button></div>`;
    c.appendChild(div);
    total += (t.type==='income'? t.amount : -t.amount);
  });
  document.getElementById('total').textContent='₪'+total.toFixed(2);
}

function editTransaction(id){
  const t = transactions.find(x=>x.id===id);
  if(!t) return;
  document.getElementById('type').value=t.type;
  document.getElementById('amount').value=t.amount;
  document.getElementById('category').value=t.category;
  document.getElementById('description').value=t.description;
  document.getElementById('date').value=t.date;
  deleteTransaction(id);
}

function deleteTransaction(id){
  transactions=transactions.filter(x=>x.id!==id);
  saveData();
  renderTransactions();
}

function addCategory(){
  const name=document.getElementById('new-category-name').value.trim();
  const budget=parseFloat(document.getElementById('new-category-budget').value)||0;
  if(!name) return;
  categories.push({name, budget});
  saveData();
  renderCategories();
}

function renderCategories(){
  const c=document.getElementById('categories-container');
  c.innerHTML='';
  categories.forEach(cat=>{
    const spent=transactions.filter(t=>t.type==='expense' && t.category===cat.name).reduce((s,t)=>s+t.amount,0);
    const div=document.createElement('div');
    div.className='border p-2 mb-2';
    div.innerHTML=`${cat.name} | תקציב: ₪${cat.budget} | הוצא: ₪${spent}`;
    c.appendChild(div);
  });
}

function renderReports(){
  const totalExp=transactions.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);
  const totalInc=transactions.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
  const net=totalInc-totalExp;
  document.getElementById('report-summary').innerHTML=`סה\"כ הכנסות: ₪${totalInc} | הוצאות: ₪${totalExp} | מאזן: ₪${net}`;
  const ctx=document.getElementById('report-chart').getContext('2d');
  if(window.repChart) window.repChart.destroy();
  window.repChart=new Chart(ctx,{type:'pie',data:{labels:['הכנסות','הוצאות'],datasets:[{data:[totalInc,totalExp],backgroundColor:['#4CAF50','#f44336']}]} });
}

</script>
</body>
</html>
