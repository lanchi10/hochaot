<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>קופה קטנה - אפליקציה לניהול הוצאות אישיות</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .rtl { direction: rtl; text-align: right; }
        .chart-container { height: 300px; margin: 20px 0; }
        select, input { color: #374151 !important; background-color: white !important; }
        select option { color: #374151 !important; background-color: white !important; }
        .expense-item { border-right: 4px solid #e5e7eb; }
        .expense-item.coffee { border-right-color: #8b4513; }
        .expense-item.food { border-right-color: #22c55e; }
        .expense-item.treats { border-right-color: #f59e0b; }
        .expense-item.other { border-right-color: #6366f1; }
        @media print {
            body { margin: 0; padding: 20px; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-50 rtl">
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-lg shadow-lg mb-6">
            <h1 class="text-3xl font-bold text-center">
                <i class="fas fa-coins ml-2"></i>
                קופה קטנה
            </h1>
            <p class="text-center text-blue-100 mt-2">ניהול הוצאות אישיות קטנות ויומיומיות</p>
        </div>

        <!-- Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex flex-wrap justify-center p-4 space-x-2 space-x-reverse">
                <button onclick="showSection('add-expense')" class="nav-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg m-1">
                    <i class="fas fa-plus ml-2"></i>הוסף הוצאה
                </button>
                <button onclick="showSection('expenses-list')" class="nav-btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg m-1">
                    <i class="fas fa-list ml-2"></i>רשימת הוצאות
                </button>
                <button onclick="showSection('reports')" class="nav-btn bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg m-1">
                    <i class="fas fa-chart-bar ml-2"></i>דוחות
                </button>
                <button onclick="showSection('categories')" class="nav-btn bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg m-1">
                    <i class="fas fa-tags ml-2"></i>ניהול קטגוריות
                </button>
            </div>
        </div>

        <!-- Add Expense Section -->
        <div id="add-expense" class="section bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-plus text-blue-500 ml-2"></i>הוספת הוצאה חדשה
            </h2>
            <form id="expense-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">סכום (₪)</label>
                        <input type="number" id="amount" step="0.01" min="0" required 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">תאריך</label>
                        <input type="date" id="date" required 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">תיאור</label>
                    <input type="text" id="description" required placeholder="לדוגמה: קפה הפוך, חטיף שוקולד"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">קטגוריה</label>
                    <select id="category" required 
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">בחר קטגוריה...</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold transition duration-300">
                    <i class="fas fa-save ml-2"></i>שמור הוצאה
                </button>
            </form>
        </div>

        <!-- Expenses List Section -->
        <div id="expenses-list" class="section bg-white rounded-lg shadow-md p-6 mb-6 hidden">
            <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-list text-green-500 ml-2"></i>רשימת הוצאות
                </h2>
                <div class="flex flex-wrap gap-2 mt-4 md:mt-0">
                    <select id="filter-category" class="p-2 border border-gray-300 rounded-lg">
                        <option value="">כל הקטגוריות</option>
                    </select>
                    <select id="sort-by" class="p-2 border border-gray-300 rounded-lg">
                        <option value="date-desc">תאריך - חדש לישן</option>
                        <option value="date-asc">תאריך - ישן לחדש</option>
                        <option value="amount-desc">סכום - גבוה לנמוך</option>
                        <option value="amount-asc">סכום - נמוך לגבוה</option>
                    </select>
                </div>
            </div>
            <div id="expenses-container" class="space-y-3">
                <!-- Expenses will be loaded here -->
            </div>
            <div id="total-display" class="text-center mt-6 p-4 bg-gray-100 rounded-lg">
                <span class="text-lg font-bold">סך הכל: <span id="total-amount">₪0</span></span>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section bg-white rounded-lg shadow-md p-6 mb-6 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-chart-bar text-purple-500 ml-2"></i>דוחות והצגה ויזואלית
            </h2>
            
            <!-- Report Period Selector -->
            <div class="mb-6">
                <div class="flex flex-wrap justify-center gap-2">
                    <button onclick="showReport('weekly')" class="report-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                        דוח שבועי
                    </button>
                    <button onclick="showReport('monthly')" class="report-btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg">
                        דוח חודשי
                    </button>
                    <button onclick="showReport('yearly')" class="report-btn bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg">
                        דוח שנתי
                    </button>
                </div>
            </div>

            <!-- Report Summary -->
            <div id="report-summary" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-blue-100 p-4 rounded-lg text-center">
                    <h3 class="font-semibold text-blue-800">סך הכל</h3>
                    <p id="report-total" class="text-2xl font-bold text-blue-600">₪0</p>
                </div>
                <div class="bg-green-100 p-4 rounded-lg text-center">
                    <h3 class="font-semibold text-green-800">מספר הוצאות</h3>
                    <p id="report-count" class="text-2xl font-bold text-green-600">0</p>
                </div>
                <div class="bg-orange-100 p-4 rounded-lg text-center">
                    <h3 class="font-semibold text-orange-800">ממוצע יומי</h3>
                    <p id="report-average" class="text-2xl font-bold text-orange-600">₪0</p>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-center mb-4">חלוקה לפי קטגוריות</h3>
                    <div class="chart-container">
                        <canvas id="pie-chart"></canvas>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-center mb-4">מגמות לאורך זמן</h3>
                    <div class="chart-container">
                        <canvas id="line-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Export Button -->
            <div class="text-center mt-6">
                <button onclick="exportToCSV()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold">
                    <i class="fas fa-download ml-2"></i>ייצא ל-CSV
                </button>
            </div>
        </div>

        <!-- Categories Management Section -->
        <div id="categories" class="section bg-white rounded-lg shadow-md p-6 mb-6 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-tags text-orange-500 ml-2"></i>ניהול קטגוריות
            </h2>
            
            <!-- Add New Category -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold mb-3">הוסף קטגוריה חדשה</h3>
                <div class="flex gap-2">
                    <input type="text" id="new-category-name" placeholder="שם הקטגוריה החדשה" 
                           class="flex-1 p-3 border border-gray-300 rounded-lg">
                    <button onclick="addCategory()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg">
                        <i class="fas fa-plus"></i> הוסף
                    </button>
                </div>
            </div>

            <!-- Categories List -->
            <div id="categories-list" class="space-y-3">
                <!-- Categories will be loaded here -->
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-600 mt-8">
            <p><i class="fas fa-coins text-blue-500"></i> קופה קטנה - ניהול הוצאות אישיות פשוט ויעיל</p>
        </div>
    </div>

    <!-- Edit Expense Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">ערוך הוצאה</h3>
            <form id="edit-form" class="space-y-4">
                <input type="hidden" id="edit-id">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">סכום (₪)</label>
                    <input type="number" id="edit-amount" step="0.01" min="0" required 
                           class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">תיאור</label>
                    <input type="text" id="edit-description" required 
                           class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">קטגוריה</label>
                    <select id="edit-category" required 
                            class="w-full p-3 border border-gray-300 rounded-lg">
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">תאריך</label>
                    <input type="date" id="edit-date" required 
                           class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                        שמור שינויים
                    </button>
                    <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
                        ביטול
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data storage
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || [
            { name: 'קפה', color: '#8b4513', class: 'coffee' },
            { name: 'אוכל/נישנושים', color: '#22c55e', class: 'food' },
            { name: 'פינוקים', color: '#f59e0b', class: 'treats' },
            { name: 'אחר', color: '#6366f1', class: 'other' }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('date').valueAsDate = new Date();
            updateCategorySelects();
            showSection('add-expense');
            loadExpenses();
        });

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('expenses', JSON.stringify(expenses));
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        // Show section
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            if (sectionName === 'expenses-list') {
                loadExpenses();
            } else if (sectionName === 'reports') {
                showReport('monthly');
            } else if (sectionName === 'categories') {
                loadCategories();
            }
        }

        // Update category selects
        function updateCategorySelects() {
            const selects = ['category', 'edit-category', 'filter-category'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = selectId === 'filter-category' ? 
                        '<option value="">כל הקטגוריות</option>' : 
                        '<option value="">בחר קטגוריה...</option>';
                    
                    categories.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat.name;
                        option.textContent = cat.name;
                        select.appendChild(option);
                    });
                    
                    if (currentValue) select.value = currentValue;
                }
            });
        }

        // Add expense
        document.getElementById('expense-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const expense = {
                id: Date.now(),
                amount: parseFloat(document.getElementById('amount').value),
                description: document.getElementById('description').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value
            };
            
            expenses.push(expense);
            saveData();
            
            // Reset form
            this.reset();
            document.getElementById('date').valueAsDate = new Date();
            
            alert('ההוצאה נשמרה בהצלחה!');
        });

        // Load expenses
        function loadExpenses() {
            const container = document.getElementById('expenses-container');
            const filterCategory = document.getElementById('filter-category').value;
            const sortBy = document.getElementById('sort-by').value;
            
            let filteredExpenses = expenses;
            
            // Filter by category
            if (filterCategory) {
                filteredExpenses = expenses.filter(exp => exp.category === filterCategory);
            }
            
            // Sort expenses
            filteredExpenses.sort((a, b) => {
                switch (sortBy) {
                    case 'date-desc': return new Date(b.date) - new Date(a.date);
                    case 'date-asc': return new Date(a.date) - new Date(b.date);
                    case 'amount-desc': return b.amount - a.amount;
                    case 'amount-asc': return a.amount - b.amount;
                    default: return new Date(b.date) - new Date(a.date);
                }
            });
            
            // Display expenses
            container.innerHTML = '';
            let total = 0;
            
            filteredExpenses.forEach(expense => {
                total += expense.amount;
                const category = categories.find(cat => cat.name === expense.category);
                const expenseClass = category ? category.class : 'other';
                
                const expenseDiv = document.createElement('div');
                expenseDiv.className = `expense-item ${expenseClass} bg-gray-50 p-4 rounded-lg`;
                expenseDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-semibold text-gray-800">${expense.description}</h3>
                                <span class="text-lg font-bold text-gray-700">₪${expense.amount.toFixed(2)}</span>
                            </div>
                            <div class="text-sm text-gray-600">
                                <span class="bg-gray-200 px-2 py-1 rounded text-xs ml-2">${expense.category}</span>
                                <span>${new Date(expense.date).toLocaleDateString('he-IL')}</span>
                            </div>
                        </div>
                        <div class="flex gap-2 mr-4">
                            <button onclick="editExpense(${expense.id})" class="text-blue-500 hover:text-blue-700">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteExpense(${expense.id})" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(expenseDiv);
            });
            
            document.getElementById('total-amount').textContent = `₪${total.toFixed(2)}`;
            
            if (filteredExpenses.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8">אין הוצאות להצגה</p>';
            }
        }

        // Edit expense
        function editExpense(id) {
            const expense = expenses.find(exp => exp.id === id);
            if (!expense) return;
            
            document.getElementById('edit-id').value = expense.id;
            document.getElementById('edit-amount').value = expense.amount;
            document.getElementById('edit-description').value = expense.description;
            document.getElementById('edit-category').value = expense.category;
            document.getElementById('edit-date').value = expense.date;
            
            document.getElementById('edit-modal').classList.remove('hidden');
            document.getElementById('edit-modal').classList.add('flex');
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            document.getElementById('edit-modal').classList.remove('flex');
        }

        // Handle edit form submission
        document.getElementById('edit-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('edit-id').value);
            const expenseIndex = expenses.findIndex(exp => exp.id === id);
            
            if (expenseIndex !== -1) {
                expenses[expenseIndex] = {
                    id: id,
                    amount: parseFloat(document.getElementById('edit-amount').value),
                    description: document.getElementById('edit-description').value,
                    category: document.getElementById('edit-category').value,
                    date: document.getElementById('edit-date').value
                };
                
                saveData();
                loadExpenses();
                closeEditModal();
                alert('ההוצאה עודכנה בהצלחה!');
            }
        });

        // Delete expense
        function deleteExpense(id) {
            if (confirm('האם אתה בטוח שברצונך למחוק הוצאה זו?')) {
                expenses = expenses.filter(exp => exp.id !== id);
                saveData();
                loadExpenses();
            }
        }

        // Filter and sort event listeners
        document.getElementById('filter-category').addEventListener('change', loadExpenses);
        document.getElementById('sort-by').addEventListener('change', loadExpenses);

        // Show report
        function showReport(period) {
            const now = new Date();
            let filteredExpenses = [];
            
            switch (period) {
                case 'weekly':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredExpenses = expenses.filter(exp => new Date(exp.date) >= weekAgo);
                    break;
                case 'monthly':
                    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                    filteredExpenses = expenses.filter(exp => new Date(exp.date) >= monthStart);
                    break;
                case 'yearly':
                    const yearStart = new Date(now.getFullYear(), 0, 1);
                    filteredExpenses = expenses.filter(exp => new Date(exp.date) >= yearStart);
                    break;
            }
            
            updateReportSummary(filteredExpenses, period);
            updateCharts(filteredExpenses, period);
        }

        // Update report summary
        function updateReportSummary(expenses, period) {
            const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const count = expenses.length;
            
            let days = 1;
            switch (period) {
                case 'weekly': days = 7; break;
                case 'monthly': days = new Date().getDate(); break;
                case 'yearly': 
                    const now = new Date();
                    const start = new Date(now.getFullYear(), 0, 1);
                    days = Math.ceil((now - start) / (1000 * 60 * 60 * 24));
                    break;
            }
            
            const average = days > 0 ? total / days : 0;
            
            document.getElementById('report-total').textContent = `₪${total.toFixed(2)}`;
            document.getElementById('report-count').textContent = count;
            document.getElementById('report-average').textContent = `₪${average.toFixed(2)}`;
        }

        // Update charts
        let pieChart, lineChart;
        
        function updateCharts(expenses, period) {
            updatePieChart(expenses);
            updateLineChart(expenses, period);
        }

        function updatePieChart(expenses) {
            const categoryTotals = {};
            expenses.forEach(exp => {
                categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
            });
            
            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);
            const colors = labels.map(label => {
                const category = categories.find(cat => cat.name === label);
                return category ? category.color : '#6366f1';
            });
            
            const ctx = document.getElementById('pie-chart').getContext('2d');
            
            if (pieChart) {
                pieChart.destroy();
            }
            
            pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            rtl: true,
                            textDirection: 'rtl'
                        }
                    }
                }
            });
        }

        function updateLineChart(expenses, period) {
            const dailyTotals = {};
            
            expenses.forEach(exp => {
                const date = exp.date;
                dailyTotals[date] = (dailyTotals[date] || 0) + exp.amount;
            });
            
            const sortedDates = Object.keys(dailyTotals).sort();
            const labels = sortedDates.map(date => new Date(date).toLocaleDateString('he-IL'));
            const data = sortedDates.map(date => dailyTotals[date]);
            
            const ctx = document.getElementById('line-chart').getContext('2d');
            
            if (lineChart) {
                lineChart.destroy();
            }
            
            lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'הוצאות יומיות',
                        data: data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            rtl: true,
                            textDirection: 'rtl'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Export to CSV
        function exportToCSV() {
            if (expenses.length === 0) {
                alert('אין נתונים לייצוא');
                return;
            }
            
            const BOM = '\uFEFF';
            const headers = ['תאריך', 'תיאור', 'קטגוריה', 'סכום'];
            const csvContent = BOM + headers.join(',') + '\n' +
                expenses.map(exp => [
                    new Date(exp.date).toLocaleDateString('he-IL'),
                    `"${exp.description}"`,
                    `"${exp.category}"`,
                    exp.amount.toFixed(2)
                ].join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `קופה_קטנה_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // Category management
        function loadCategories() {
            const container = document.getElementById('categories-list');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'bg-gray-50 p-4 rounded-lg flex justify-between items-center';
                categoryDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full ml-3" style="background-color: ${category.color}"></div>
                        <span class="font-semibold">${category.name}</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editCategory('${category.name}')" class="text-blue-500 hover:text-blue-700 px-2 py-1">
                            <i class="fas fa-edit"></i> ערוך
                        </button>
                        ${!['קפה', 'אוכל/נישנושים', 'פינוקים', 'אחר'].includes(category.name) ? 
                            `<button onclick="deleteCategory('${category.name}')" class="text-red-500 hover:text-red-700 px-2 py-1">
                                <i class="fas fa-trash"></i> מחק
                            </button>` : ''}
                    </div>
                `;
                container.appendChild(categoryDiv);
            });
        }

        function addCategory() {
            const name = document.getElementById('new-category-name').value.trim();
            if (!name) {
                alert('אנא הכנס שם לקטגוריה');
                return;
            }
            
            if (categories.find(cat => cat.name === name)) {
                alert('קטגוריה זו כבר קיימת');
                return;
            }
            
            const colors = ['#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#06b6d4', '#84cc16', '#f97316', '#ec4899'];
            const color = colors[categories.length % colors.length];
            
            categories.push({
                name: name,
                color: color,
                class: name.toLowerCase().replace(/[^a-z0-9]/g, '')
            });
            
            saveData();
            updateCategorySelects();
            loadCategories();
            document.getElementById('new-category-name').value = '';
            alert('הקטגוריה נוספה בהצלחה!');
        }

        function editCategory(oldName) {
            const newName = prompt('הכנס שם חדש לקטגוריה:', oldName);
            if (!newName || newName === oldName) return;
            
            if (categories.find(cat => cat.name === newName)) {
                alert('קטגוריה זו כבר קיימת');
                return;
            }
            
            // Update category name
            const category = categories.find(cat => cat.name === oldName);
            if (category) {
                category.name = newName;
            }
            
            // Update expenses with old category name
            expenses.forEach(exp => {
                if (exp.category === oldName) {
                    exp.category = newName;
                }
            });
            
            saveData();
            updateCategorySelects();
            loadCategories();
            alert('הקטגוריה עודכנה בהצלחה!');
        }

        function deleteCategory(name) {
            const expensesInCategory = expenses.filter(exp => exp.category === name);
            if (expensesInCategory.length > 0) {
                if (!confirm(`יש ${expensesInCategory.length} הוצאות בקטגוריה זו. האם אתה בטוח שברצונך למחוק אותה? ההוצאות יועברו לקטגוריה "אחר".`)) {
                    return;
                }
                
                // Move expenses to "אחר" category
                expenses.forEach(exp => {
                    if (exp.category === name) {
                        exp.category = 'אחר';
                    }
                });
            }
            
            categories = categories.filter(cat => cat.name !== name);
            saveData();
            updateCategorySelects();
            loadCategories();
            alert('הקטגוריה נמחקה בהצלחה!');
        }

        // Initialize categories on first load
        if (categories.length === 0) {
            categories = [
                { name: 'קפה', color: '#8b4513', class: 'coffee' },
                { name: 'אוכל/נישנושים', color: '#22c55e', class: 'food' },
                { name: 'פינוקים', color: '#f59e0b', class: 'treats' },
                { name: 'אחר', color: '#6366f1', class: 'other' }
            ];
            saveData();
        }
    </script>
</body>
</html>
